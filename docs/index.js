let allVoices=[];loadConfig(),loadVoices();function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function loadVoices(){const e=new Promise(e=>{let t=speechSynthesis.getVoices();if(t.length!==0)e(t);else{let n=!1;speechSynthesis.addEventListener("voiceschanged",()=>{n=!0,t=speechSynthesis.getVoices(),e(t)}),setTimeout(()=>{n||document.getElementById("noTTS").classList.remove("d-none")},1e3)}});e.then(e=>{allVoices=e,addLangRadioBox(),addVoiceSelect()})}function showVoiceInfo(e){document.getElementById("voiceLang").textContent=e.lang,document.getElementById("voiceDefault").textContent=e.default,document.getElementById("voiceLocalService").textContent=e.localService,document.getElementById("voiceName").textContent=e.name,document.getElementById("voiceURI").textContent=e.voiceURI}function selectVoice(e,t){const n=document.getElementById("selectVoice").options,s=n[n.selectedIndex].value;switch(n.selectedIndex){case 0:return e[Math.floor(Math.random()*e.length)];case 1:{const n=e.filter(e=>e.lang==t);return n[Math.floor(Math.random()*n.length)]}default:{const n=e.filter(e=>e.lang==t);return n.find(e=>e.name==s)}}}function speak(e){speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(e),s=document.getElementById("langRadio").elements.lang.value,n=selectVoice(allVoices,s);return showVoiceInfo(n),t.voice=n,t.lang=document.getElementById("langRadio").elements.lang.value,t.pitch=document.getElementById("pitch").value,t.rate=document.getElementById("rate").value,t.volume=document.getElementById("volume").value,speechSynthesis.speak(t),t}function initVoiceSelect(){const e=document.getElementById("selectVoice");e.replaceChildren();const t=document.createElement("option");t.textContent="random (all languages)",e.appendChild(t);const n=document.createElement("option");n.textContent="random (selected language)",e.appendChild(n)}function addVoiceSelect(){initVoiceSelect();const e=document.getElementById("selectVoice");allVoices.filter(e=>e.lang=="en-US").forEach(t=>{const n=document.createElement("option");n.textContent=t.name,e.appendChild(n)}),e.onchange=()=>{const e=document.getElementById("langRadio").elements.lang.value;allVoices.filter(t=>t.lang==e).forEach(e=>{showVoiceInfo(e)})}}function addLangRadioBox(){const e=document.getElementById("langRadio");e.replaceChildren();const t=allVoices.map(e=>e.lang),n=[...new Set(t)];n.sort().forEach(t=>{const o=document.createElement("div");o.className="form-check form-check-inline";const n=document.createElement("input");n.className="form-check-input",n.name="lang",n.type="radio",n.value=t;const s=document.createElement("label");s.className="from-check-label",s.textContent=t,s.appendChild(n),o.appendChild(s),e.appendChild(o),(t=="en-US"||t=="en_US")&&(n.checked=!0)}),e.onchange=()=>{const t=e.elements.lang.value;initVoiceSelect();const n=document.getElementById("selectVoice");allVoices.filter(e=>e.lang==t).forEach(e=>{const t=document.createElement("option");t.textContent=e.name,n.appendChild(t)})}}function resetPitch(){document.getElementById("pitch").value=1}function resetRate(){document.getElementById("rate").value=1}function resetVolume(){document.getElementById("volume").value=1}function search(){const e=document.getElementById("searchText").value;speak(e)}document.addEventListener("keydown",e=>{e.key=="Enter"&&search()}),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("search").onclick=search,document.getElementById("resetPitch").onclick=resetPitch,document.getElementById("resetRate").onclick=resetRate,document.getElementById("resetVolume").onclick=resetVolume